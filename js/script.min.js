"use strict";window.util={getRandomEl:function(e){return e[Math.floor(Math.random()*e.length)]},getRandomInt:function(e,n){return Math.floor(Math.random()*(n-e+1))+e},shuffle:function(e){for(var n,r,t=e.length-1;0<t;t--)r=e[n=Math.floor(Math.random()*(t+1))],e[n]=e[t],e[t]=r;return e},removeChildren:function(e,n){for(n=n||"*";e.querySelector(n);)e.removeChild(e.querySelector(n))},renderFragment:function(e,t,o){return e.reduce(function(e,n){var r=t(n);return o&&o(r,n),e.appendChild(r),e},document.createDocumentFragment())},renderObjects:function(e,t){return e.reduce(function(e,n){var r=n.render();return t&&t(r,n),e.appendChild(r),e},document.createDocumentFragment())},show:function(e,n){e.classList.remove(n?"visually-hidden":"hidden")},hide:function(e,n){e.classList.add(n?"visually-hidden":"hidden")},isEscEvent:function(e,n){"Escape"===e.code&&n()}};
"use strict";!(function(){var o=["Всё отлично!","В целом всё неплохо. Но не всё.","Когда вы делаете фотографию, хорошо бы убирать палец из кадра. В конце концов это просто непрофессионально.","Моя бабушка случайно чихнула с фотоаппаратом в руках и у неё получилась фотография лучше.","Я поскользнулся на банановой кожуре и уронил фотоаппарат на кота и у меня получилась фотография лучше.","Лица у людей на фотке перекошены, как будто их избивают. Как можно было поймать такой неудачный момент?!"],i=["Тестим новую камеру!","Затусили с друзьями на море","Как же круто тут кормят","Отдыхаем...","Цените каждое мгновенье. Цените тех, кто рядом с вами и отгоняйте все сомненья. Не обижайте всех словами......","Вот это тачка!"],a=["Иван","Василий","Колян","Марья","Василиса","Елена","Аким","Тимур","Анна"],d=[1,6];window.data={template:document.querySelector("#main-template").content,generatePictures:function(t){t=t<25?t:25;for(var n=[],e=0;e<t;e++)n[e]={url:"photos/"+(e+1)+".jpg",likes:window.util.getRandomInt(15,200),comments:(function(t){for(var n=[],e=0;e<t;e++)n[e]={avatar:"img/avatar-"+window.util.getRandomInt(d[0],d[1])+".svg",message:window.util.getRandomInt(0,1)?window.util.getRandomEl(o):window.util.getRandomEl(o)+" "+window.util.getRandomEl(o),name:window.util.getRandomEl(a)};return n})(window.util.getRandomInt(1,20)),description:window.util.getRandomEl(i)};return window.util.shuffle(n)}}})();
"use strict";!(function(){var i;window.debounce=function(e,t){t=t||500,clearTimeout(i),i=setTimeout(e,t)}})();
"use strict";!(function(){function i(e){e.classList.add("message-bar--hidden"),setTimeout(function(){e.remove()},500)}var o={error:"Ошибка",success:"Успех",default:"Инфо"},r=window.data.template.querySelector(".message-bar"),c=document.querySelector(".message-panel");window.message={show:function(e,t){t=t||"default";var n=r.cloneNode(!0),s=n.querySelector(".message-bar__label"),a=n.querySelector(".message-bar__text");n.classList.add("message-bar--"+t),s.innerText=o[t],a.innerText=e,document.addEventListener("keydown",function(e){window.util.isEscEvent(e,function(){i(n)})}),n.addEventListener("click",function(){i(n)}),c.appendChild(n),setTimeout(i,3e3,n)}}})();
"use strict";!(function(){function s(t){window.message.show(t,"error")}function n(t,e,a,s,n,o){var u=new XMLHttpRequest;u.responseType="json",u.timeout=o||u.timeout,u.addEventListener("load",function(){200===u.status?a(u.response):s(u.status+" "+(i[u.status]||i.default+": "+u.statusText))}),u.addEventListener("error",function(){s(u.status+" "+d)}),u.addEventListener("timeout",function(){s(r+u.timeout+c)}),u.open(t,e),u.send()}var o="https://23.javascript.pages.academy/kekstagram",a="https://23.javascript.pages.academy/kekstagram/data",i={400:"Неверный запрос",401:"Пользователь не авторизован",404:"Ничего не дайдено",500:"Ошибка сервера",default:"Ошибка"},d="Ошибка соединения с сервером",r="Запрос не успел выполниться за ",c=" мс";window.backend={load:function(t,e){n("GET",a,t,e)},upload:function(t,e,a){n("POST",o,e,a=a||s)}}})();
"use strict";var Popup=function(e){this.el=document.querySelector(e||this.DEFAULT_SELECTOR),this.elClose=this.el.querySelector(".popup__close")};Popup.prototype={DEFAULT_SELECTOR:".popup",open:function(){this.elClose.addEventListener("click",this._onPopupCloseClick.bind(this)),document.addEventListener("keydown",this._onEscPress.bind(this)),this.onOpen(),window.util.show(this.el)},close:function(){window.util.hide(this.el),this.elClose.removeEventListener("click",this._onPopupCloseClick),document.removeEventListener("keydown",this._onEscPress),this.onClose()},onOpen:function(){},onClose:function(){},_onPopupCloseClick:function(){this.close()},_onEscPress:function(e){window.util.isEscEvent(e,this.close)}};
"use strict";var Scale=function(e,t){this.value=t||this.Value.DEFAULT,this.el=document.querySelector(e||this.DEFAULT_SELECTOR),this.elLine=this.el.querySelector(".scale__line"),this.elPin=this.el.querySelector(".scale__pin"),this.elLevel=this.el.querySelector(".scale__level"),this.elValue=this.el.querySelector(".scale__value"),this.elPin.addEventListener("mousedown",this._onPinMouseDown.bind(this))};Scale.prototype={DEFAULT_SELECTOR:".scale",Value:{MIN:0,MAX:100,DEFAULT:100},update:function(e,t){this._updateLevel(e),this._setValue(e),this.elValue.value=this.value,t||this.onUpdate(this.value)},reset:function(){this.update(this.Value.DEFAULT,!0)},show:function(){window.util.show(this.el)},hide:function(){window.util.hide(this.el)},onUpdate:function(e){return e},_calcLevel:function(e){return(this.elPin.offsetLeft+e)/this.elLine.offsetWidth*100},_updateLevel:function(e){e+="%";this.elPin.style.left=e,this.elLevel.style.width=e},_setValue:function(e){this.value=Math.round(e)},_onPinMouseDown:function(e){function t(e){var t=e.clientX-n;n=e.clientX,(t=i._calcLevel(t))>=i.Value.MIN&&t<=i.Value.MAX&&i.update(t)}var i=this,n=e.clientX;document.addEventListener("mousemove",t),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",t)})}};
"use strict";!(function(){function e(e){var r=parseInt(a.value,10);return e&&t<r?r-=o:!e&&r<n&&(r+=o),r}function r(e){a.value=e+"%",c.style.transform="scale("+e/100+")"}var t=25,n=100,i=100,o=25,c=document.querySelector(".img-upload__preview img"),u=document.querySelector(".img-upload__resize"),l=u.querySelector(".resize__control--minus"),s=u.querySelector(".resize__control--plus"),a=u.querySelector(".resize__control--value");l.addEventListener("click",function(){r(e(!0))}),s.addEventListener("click",function(){r(e(!1))}),window.imageSize={reset:function(){r(i)}}})();
"use strict";!(function(){function t(e,t){e=0<=e?e:100,t=t||i||"heat",i&&i!==t&&(s.classList.remove("effects__preview--"+i),s.classList.add("effects__preview--"+t)),s.style.filter={chrome:"grayscale("+e/100+")",sepia:"sepia("+e/100+")",marvin:"invert("+e+"%)",phobos:"blur("+5*e/100+"px)",heat:"brightness("+(2*e/100+1)+")"}[t]||"",i=t}var s=document.querySelector(".img-upload__preview img"),i="",r=new window.Scale(".img-upload__scale");r.onUpdate=function(e){t(e)},document.querySelector(".effects").addEventListener("change",function(e){e=e.target.value;t(100,e),r.reset(),"none"===e?r.hide():r.show()}),window.imageEffect={apply:t,reset:function(){s.classList.remove("effects__preview--"+i),s.style.filter="",i="",r.reset(),r.show()}}})();
"use strict";!(function(){function e(){var t,e,i,n,r=l.value,o="",a=(a=r.trim().toLowerCase().split(" ")).filter(function(t){return""!==t});if(r.match(d))o=u.TAGS_PATTERN;else if(5<a.length)o=u.TAGS_NUM;else for(var s=0;s<a.length&&(t=a[s],e=s,i=a,n=void 0,n=t[0],i=i.indexOf(t,e+1),e="","#"!==n?e=u.NO_HASH:"#"===n&&1===t.length?e=u.ONLY_HASH:20<t.length?e=u.TAG_TOO_LONG:0<i&&(e=u.TAG_NOT_UNIQUE),!(o=e));s++);l.setCustomValidity(o),l.reportValidity()}var d=/[^\w\sА-Яа-яЁё\# -]/,u={NO_HASH:"Хэш-тег должен начинаться с символа # (решётка)",ONLY_HASH:"Хэш-тег не может состоять только из одной решётки",TAG_TOO_LONG:"Максимальная длина одного хэш-тега 20 символов, включая решётку",TAG_NOT_UNIQUE:"Один и тот же хэш-тег не может быть использован дважды",TAGS_PATTERN:'Хэш-теги разделяются пробелами. Используются буквы, цифры, символы "-", "_"',TAGS_NUM:"Можно указать не больше 5 хэш-тегов",COMMENT_TOO_SHORT:"Минимальная длина комментария 20 cимволов, хотя он и не обязателен,)",COMMENT_TOO_LONG:"Максимальная длина комментария 140 cимволов, хотя он и не обязателен,)"},i=document.querySelector(".img-upload__form"),l=i.querySelector(".text__hashtags"),n=i.querySelector(".text__description");n.addEventListener("invalid",function(){var t;t="",n.validity.tooShort?t=u.COMMENT_TOO_SHORT:n.validity.tooLong&&(t=u.COMMENT_TOO_LONG),n.setCustomValidity(t)});var t=i.querySelector(".img-upload__text");t.addEventListener("invalid",function(t){t.target.classList.add("input-error")},!0),t.addEventListener("input",function(t){t.target.setCustomValidity(""),t.target.validity.valid&&t.target.classList.remove("input-error")}),t.addEventListener("keydown",function(t){window.util.isEscEvent(t,function(){t.stopPropagation()})});function r(){window.message.show("Изображение загружено :)","success"),o.onSend()}i.addEventListener("submit",function(t){t.preventDefault(),e(),l.validity.valid&&window.backend.upload(new FormData(i),r)});var o={reset:function(){var t;i.reset(),t=i.querySelectorAll(".input-error"),Array.from(t).forEach(function(t){t.setCustomValidity(""),t.classList.remove("input-error")})},onSend:function(){}};window.uploadForm=o})();
"use strict";!(function(){var o=["image/jpeg","image/png"],i=new window.Popup(".img-upload__overlay");i.onOpen=function(){window.imageEffect.apply()},i.onClose=function(){window.uploadForm.reset(),window.imageEffect.reset(),window.imageSize.reset()},window.uploadForm.onSend=function(){i.close()};var r=i.el.querySelector(".img-upload__preview img"),a=document.querySelector("#upload-file");a.addEventListener("change",function(){var e,n=a.files[0];o.some(function(e){return n.type===e})?((e=new FileReader).addEventListener("load",function(){r.src=e.result,i.open()}),e.readAsDataURL(n)):window.message.show("Поддерживаются форматы JPG и PNG","error")}),window.upload=i})();
"use strict";!(function(){function t(t){this.id=t.id,this.image=t.url,this.description=t.description,this.likesNum=t.likes,this.comments=t.comments,this.commentsNum=t.comments.length}var e=window.data.template.querySelector(".picture__link");t.prototype={render:function(){var t=e.cloneNode(!0);return t.querySelector(".picture__img").src=this.image,t.querySelector(".picture__stat--likes").textContent=this.likesNum,t.querySelector(".picture__stat--comments").textContent=this.commentsNum,t}},window.Picture=t})();
"use strict";!(function(){function t(e){var t=i.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__text").textContent=e.message,t.querySelector(".social__author").textContent=e.name,t}function c(e){e&&(s=e,m=0,window.util.removeChildren(o)),e=s.splice(0,5),m+=e.length,o.appendChild(window.util.renderFragment(e,t)),n.innerText=m,0===s.length&&window.util.hide(u,!0)}var l=new window.Popup(".big-picture"),o=l.el.querySelector(".social__comments"),r=l.el.querySelector(".social__comment-count"),n=r.querySelector(".comments-loaded"),u=l.el.querySelector(".social__comment-loadmore"),i=window.data.template.querySelector(".social__comment"),s=[],m=0;u.addEventListener("click",function(){c()}),l.onClose=function(){window.util.show(r,!0),window.util.show(u,!0)},window.preview={show:function(e){!(function(e){l.el.querySelector(".big-picture__img img").src=e.image,l.el.querySelector(".likes-count").textContent=e.likesNum,l.el.querySelector(".comments-count").textContent=e.commentsNum;var t=e.description.trim(),o=t.split(/(#.*)/),n="",i="";"#"===t[0]?i=t:1<o.length?(n=o[0],i=o[1]):n=t,l.el.querySelector(".social__description").textContent=n.trim(),l.el.querySelector(".social__tags").textContent=i.trim(),c(e.comments.slice()),e.commentsNum<5&&(window.util.hide(r,!0),window.util.hide(u,!0))})(e),l.open()}}})();
"use strict";!(function(){function t(e){e=e||n,window.util.removeChildren(i,".picture__link"),i.appendChild(window.util.renderObjects(e,function(e,t){e.addEventListener("click",function(){window.preview.show(t)})}))}var i=document.querySelector(".pictures"),n=[],c=document.querySelector(".img-filters"),r=c.querySelectorAll(".img-filters__button"),o={"filter-popular":t,"filter-new":function(){var e=window.util.shuffle(n.slice());t(e.slice(0,10))},"filter-discussed":function(){var e=n.slice().sort(function(e,t){return t.comments.length-e.comments.length});t(e)}};c.addEventListener("click",function(e){var t=e.target.classList.contains("img-filters__button")?e.target:null;t&&(e=t,[].forEach.call(r,function(e){e.classList.remove("img-filters__button--active")}),e.classList.add("img-filters__button--active"),window.debounce(o[t.id]))});window.backend.load(function(e){n=e.map(function(e){return new window.Picture(e)}),t(),c.classList.remove("img-filters--inactive")},function(e){window.message.show("Изображения не загружены. "+e,"error")})})();